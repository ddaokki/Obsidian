## Generalized Forwarding & Flow Table (OpenFlow 포함)

### 🔹 기본 개념: Match + Action
- 라우터는 **flow table (또는 forwarding table)**을 사용하여 패킷 처리
- **"match plus action"**: 도착한 패킷의 헤더 비트를 매칭 → 대응되는 행동 수행
  - 행동 예시: 전달, 삭제, 수정, 로깅 등
- **destination-based forwarding**은 목적지 IP만 기준
- **generalized forwarding**은 다양한 헤더 필드 기반으로 처리 가능

---

### 🔹 Flow Table Abstraction
- **Flow**: 링크, 네트워크, 전송 계층의 헤더 필드 값을 기반으로 정의됨
- 구성 요소:
  - `match`: 헤더 필드에 대한 패턴
  - `action`: 일치 시 수행할 작업 (drop, forward, modify 등)
  - `priority`: 중첩된 패턴 간 우선순위 정의
  - `counters`: 매칭된 패킷 수 및 바이트 수 기록

> 예시:
> - `src = *, dest = 3.4.*.* → forward(2)`
> - `src = 1.2.*.*, dest = *.*.*.* → drop`
> - `src = 10.1.2.3, dest = *.*.*.* → send to controller`

---

### 🔹 OpenFlow: 표준화된 Flow Table 구조
#### 구성
- `Match`: 어떤 조건의 패킷에 적용할지 정의 (Layer 2~4의 다양한 필드)
- `Action`: forward, drop, modify, encapsulate to controller 등
- `Stats`: 패킷 수, 바이트 수 등 통계

#### Match 가능한 필드 예시
- **링크 계층**: Ingress Port, Src MAC, Dst MAC, VLAN ID
- **네트워크 계층**: IP Src, IP Dst, IP Protocol, ToS 등
- **전송 계층**: TCP/UDP Src Port, Dst Port 등

---

### 🔹 OpenFlow 예시들

#### 목적지 기반 포워딩
- 목적지 IP가 51.6.0.8인 데이터그램 → 포트 6으로 전달

#### 방화벽(Firewall)
- TCP 포트 22(ssh)로 향하는 모든 패킷 차단
- 호스트 128.119.1.1이 보낸 모든 패킷 차단

#### Layer 2 기반 포워딩
- 목적지 MAC 주소가 22:A7:23:11:E1:02인 프레임 → 포트 3으로 전달

---

### ✅ 요약
- 전통적인 라우팅이 단순히 목적지 IP 기준이라면, **generalized forwarding**은 다양한 조건 기반의 유연한 패킷 처리 방식
- **OpenFlow**는 이를 위한 대표적인 프로토콜이며, SDN 환경에서 핵심 역할을 담당함
- 이 구조는 **보안 제어, QoS, 로드밸런싱 등** 다양한 응용에 활용 가능함


## OpenFlow Abstraction & 예시

### 🔹 OpenFlow 추상화: match + action
- **match + action**은 다양한 네트워크 장비의 동작을 통일된 방식으로 표현하는 개념

#### 장비별 매칭 방식 예
- **Router**: 목적지 IP prefix → 해당 링크로 포워딩
- **Switch**: MAC 주소 → 포워딩 또는 브로드캐스트
- **Firewall**: IP 및 TCP/UDP 포트 → 허용 또는 차단
- **NAT**: IP/포트 기반 → 주소 및 포트 재작성

---

### 🔹 OpenFlow 예시: 네트워크 전역 동작 구현
- OpenFlow 컨트롤러는 여러 스위치(S1, S2, S3)에 분산된 포워딩 테이블을 **조율(orchestrate)**하여 네트워크 전반의 동작을 통제

#### 예시 시나리오
- Host h5(10.3.0.5), h6(10.3.0.6) → Host h3(10.2.0.3) 또는 h4(10.2.0.4)로 데이터 전송
- 흐름:
  - h5/h6 → S3 → S1 → S2 → h3/h4

#### 구성된 match-action 테이블 예
- S3: IP Src = 10.3.*, IP Dst = 10.2.* → forward(3)
- S1:
  - ingress port = 1, IP Src = 10.3.*, IP Dst = 10.2.* → forward(4)
- S2:
  - ingress port = 2, IP Dst = 10.2.0.3 → forward(3)
  - ingress port = 2, IP Dst = 10.2.0.4 → forward(4)

→ 분산된 스위치들이 OpenFlow 컨트롤러의 명령에 따라 일관되게 동작함

---

## Generalized Forwarding 정리

### 🔹 핵심 개념
- **match plus action**: 패킷 헤더 필드와 일치 여부에 따라 다양한 행동 수행
  - Drop
  - Forward
  - Modify
  - Controller로 전송
- 다양한 계층 (링크/네트워크/전송) 필드에 기반하여 일치 판단

### 🔹 네트워크 전체 동작을 설계
- 컨트롤러가 각 장비의 테이블을 조율하여 **network-wide behavior** 구현 가능
- 예: QoS, 보안 정책, 경로 최적화 등

### 🔹 네트워크 프로그래밍
- 과거: Active Networking
- 현재: P4 기반의 정교한 프로그래밍 가능 (https://p4.org 참고)

> OpenFlow는 네트워크 동작을 “프로그래밍”할 수 있게 해 주는 첫 번째 세대 기술로, SDN의 근간을 이룸
