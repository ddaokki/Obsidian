## Network-layer services and protocols
- transport segment from sending to receiving host  
  네트워크 계층은 전송 계층의 세그먼트를 송신 호스트에서 수신 호스트까지 전달하는 역할을 하며, 이는 종단 간(end-to-end) 통신의 기반이 됨

- **sender**: encapsulates segments into datagrams, passes to link layer  
  송신 측에서는 전송 계층의 세그먼트를 IP 헤더를 붙여 **데이터그램(datagram)** 으로 캡슐화하고, 이를 링크 계층으로 넘김. 이 과정은 **encapsulation**이라 불리며, 전송 계층 데이터를 네트워크 계층의 형식으로 맞추기 위한 작업임

- **receiver**: delivers segments to transport layer protocol  
  수신 측에서는 데이터그램을 받아 IP 헤더를 제거한 후, 캡슐화된 세그먼트를 전송 계층 프로토콜로 전달함. 이는 **역캡슐화(decapsulation)** 과정이며, 애플리케이션이 실제 데이터를 사용할 수 있도록 전달하는 중요한 역할임

## network layer protocols in every Internet device: hosts, routers  
- 인터넷에 연결된 모든 장치(호스트, 라우터 등)는 네트워크 계층 프로토콜을 구현하고 있음. 이는 각 장치가 IP 기반의 주소 지정과 라우팅 기능을 수행할 수 있게 해 줌

## routers:
- 라우터는 자신을 통과하는 모든 IP 데이터그램의 헤더를 분석하여, 목적지 주소 등을 기반으로 다음에 보낼 경로를 결정함. 이 과정은 **라우팅(routing)** 의 핵심이며, 효율적인 데이터 전달을 위한 기반이 됨

- 라우터는 들어온 포트(input port)에서 받은 데이터그램을 적절한 출력 포트(output port)로 전송함. 이 과정을 통해 데이터그램은 여러 라우터를 거쳐 최종 목적지까지 전달됨. 이는 **패킷 스위칭(packet switching)** 기술을 기반으로 하며, 네트워크 계층의 주된 동작 방식임

## 💡 전체 설명의 맥락
- 그림에서는 모바일 네트워크, 기업 네트워크, 글로벌 ISP, 데이터센터 등 다양한 네트워크 환경이 시각적으로 나타나 있으며, 이들을 연결하는 라우터들이 데이터그램을 어떻게 전달하는지를 보여 줌
- 네트워크 계층은 송신자에서 수신자까지의 연결성을 책임지는 핵심 계층이며, 실제 물리적 경로가 아닌 논리적 주소(IP) 기반의 경로 설정을 통해 유연하고 확장 가능한 인터넷 구조를 가능하게 함

## Two key network-layer functions
- **Forwarding**: 라우터의 입력 링크로 들어온 패킷을 적절한 출력 링크로 전송하는 작업임. 이 과정은 매우 빠르게 일어나며, 패킷이 목적지로 향하는 중간 단계에서 수행됨  
  → 예시: 고속도로의 분기점을 통과할 때 올바른 차선을 선택하는 것과 같음

- **Routing**: 패킷이 출발지에서 목적지까지 어떤 경로를 따라가야 할지 결정하는 작업임. 이는 전체 경로를 계획하는 과정으로, 여러 라우터들의 협력이 필요함  
  → 예시: 출발지에서 목적지까지 어떤 고속도로와 도로를 이용할지 전체 경로를 미리 설계하는 것과 같음

- **Routing algorithms**: 라우터 간 경로를 결정하기 위한 알고리즘으로, 최단 경로나 비용 최소화를 기반으로 경로를 선택함

## Network layer: data plane, control plane

### Data plane
- 각 라우터 내부에서 로컬하게 수행되는 기능임
- 라우터의 입력 포트로 들어온 데이터그램이 어떤 출력 포트로 나가야 하는지를 결정함
- 일반적으로 하드웨어 기반의 빠른 처리가 요구됨
- 예시 그림처럼 패킷 헤더의 값을 기반으로 포워딩 테이블을 참조하여 포트를 선택함

### Control plane
- 네트워크 전체에 대한 전반적인 논리와 경로 결정을 담당함
- 패킷이 전체 경로를 따라 어떻게 전달될지를 결정함 (라우팅 경로 설정)
- 두 가지 접근 방식이 존재함:
  - **전통적 라우팅 알고리즘**: 각 라우터가 자체적으로 라우팅 알고리즘을 실행하여 경로를 설정함 (분산형 제어)
  - **소프트웨어 정의 네트워킹(SDN)**: 라우팅 결정을 중앙 집중식 컨트롤러가 수행하며, 이 컨트롤러는 물리적으로 떨어진 서버에 위치할 수 있음 (중앙 집중형 제어)

## Per-router control plane
- 각 라우터마다 **개별적으로** 라우팅 알고리즘이 실행되며, 해당 라우터 내부에서 제어 평면(control plane)이 구성됨
- 라우터는 자신의 이웃 라우터들과 정보를 교환하며 라우팅 테이블을 스스로 계산함
- 각 라우터는 **로컬하게 독립된 제어 로직**을 가지고 있으며, 그림에서는 각 라우터의 상단에 Routing Algorithm이 탑재되어 있음
- 데이터 평면(data plane)은 하단에 위치하며, 패킷 헤더 값을 기반으로 포워딩을 수행함

### 💡 정리
- 분산형 제어 구조
- 라우터마다 제어 로직이 독립적으로 존재
- 장점: 독립성과 자율성 보장
- 단점: 네트워크 전체를 통합적으로 관리하기 어려움

## Software-Defined Networking (SDN) control plane
- **중앙 집중식** 제어 평면 구조
- SDN에서는 각 라우터가 자체적으로 라우팅 알고리즘을 수행하지 않음
- 대신, **Remote Controller**가 네트워크 전체를 바라보며 라우팅 경로를 계산하고, 각 라우터에 **포워딩 테이블**을 설치함
- 각 라우터는 Control Agent(CA)를 통해 중앙 컨트롤러와 연결되며, 컨트롤러로부터 설정 정보를 수신함
- 하단의 데이터 평면은 여전히 패킷의 포워딩을 수행하지만, 결정은 중앙 컨트롤러가 내림

### 💡 정리
- 중앙 집중형 제어 구조
- 네트워크 정책 및 라우팅 정보가 통합적으로 관리됨
- 장점: 네트워크 상태에 따른 유연한 제어 가능
- 단점: 컨트롤러 장애 시 전체 네트워크 영향 가능성 있음

## Network service model
### 개별 데이터그램에 대한 서비스 예시
- **Guaranteed delivery**: 목적지까지 도착을 보장
- **Guaranteed delivery with less than 40 msec delay**: 40밀리초 이하의 지연으로 전달 보장

### 데이터그램 흐름(flow)에 대한 서비스 예시
- **In-order datagram delivery**: 전송한 순서대로 수신 보장
- **Guaranteed minimum bandwidth to flow**: 흐름에 대해 최소 대역폭 보장
- **Restrictions on changes in inter-packet spacing**: 패킷 간 간격의 변화 제한 (일관된 전송 품질 보장 목적)

### 💡 개념 요약
- 네트워크 서비스 모델은 전송 채널이 어떤 전송 품질을 제공할지를 정의함
- 개별 패킷 또는 패킷 흐름 단위로 다양한 품질(QoS) 수준을 제공할 수 있음

## Network-layer service model (1) - Best Effort
### 인터넷의 기본 서비스 모델: Best Effort
- 전송 품질(QoS)에 대해 **어떠한 보장도 제공하지 않음**
- 아래와 같은 항목들에 대해 보장이 없음:
  i. 데이터그램이 목적지에 도달할 것이라는 보장  
  ii. 전달 순서나 타이밍에 대한 보장  
  iii. 종단 간 흐름에 대한 대역폭 보장

### 요약
- Best Effort는 **속도와 간편함**을 추구하는 기본 인터넷 서비스 모델이며, 신뢰성보다 연결성에 중점을 둠
- 네트워크 혼잡, 지연, 패킷 손실 등이 발생해도 전송을 시도만 할 뿐, 결과를 보장하지 않음

## Network-layer service model (2) - QoS 보장 여부 비교

| Network Architecture | Service Model            | Bandwidth       | Loss  | Order | Timing |
|----------------------|--------------------------|------------------|-------|-------|--------|
| Internet             | best effort              | none             | no    | no    | no     |
| ATM                  | Constant Bit Rate        | Constant rate    | yes   | yes   | yes    |
| ATM                  | Available Bit Rate       | Guaranteed min   | no    | yes   | no     |
| Internet             | Intserv Guaranteed (RFC 1633) | yes        | yes   | yes   | yes    |
| Internet             | Diffserv (RFC 2475)      | possible         | possibly | possibly | no  |

### 요약
- **ATM**은 전송 품질을 엄격히 보장하는 서비스 모델을 제공하며, 네트워크 자원을 사전에 예약함
- **Intserv**는 서비스 단위로 명시적 자원 예약을 수행함
- **Diffserv**는 트래픽 클래스를 기반으로 QoS를 차등 제공하는 모델로, 자원 예약 없이도 어느 정도 보장을 제공할 수 있음
- **Internet의 best effort**는 가장 단순하지만, QoS 보장이 전혀 없음

## Reflections on best-effort service

- **메커니즘의 단순성** 덕분에 인터넷은 전 세계적으로 빠르게 보급됨
- **충분한 대역폭 확보**가 대부분의 경우 실시간 애플리케이션(음성, 영상 등)도 “충분히 괜찮게” 동작할 수 있게 함
- **복제된 애플리케이션 계층 분산 서비스**(예: CDN, 데이터센터)는 사용자 근처에서 콘텐츠를 제공함으로써 네트워크 QoS 한계를 보완함
- **탄력적(elastic) 서비스**의 혼잡 제어 기능이 전송 품질 유지에 기여함

### 결론
- 단점에도 불구하고 Best Effort 모델은 인터넷의 **성공적인 확산과 운영을 이끈 핵심 모델**임
- "Best-effort 서비스 모델의 성공을 반박하긴 어렵다"

